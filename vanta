--// Vulkan UI Library v3
local Vulkan = {}
Vulkan.__index = Vulkan

--// Services
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UIS = game:GetService("UserInputService")
local HttpService = game:GetService("HttpService")
local Lighting = game:GetService("Lighting")

local Player = Players.LocalPlayer

--// File Protection
local canSave = writefile and readfile and isfile

--// Theme
local Theme = {
    Background = Color3.fromRGB(18,18,18),
    Container = Color3.fromRGB(28,28,28),
    Accent = Color3.fromRGB(255,85,85),
    Text = Color3.fromRGB(235,235,235)
}

--// Config
local Config = {}

--// Blur
local Blur = Instance.new("BlurEffect", Lighting)

--// Tween Helper
local function Tween(o,t,p)
    TweenService:Create(o,t,p):Play()
end

--// Notifications
local NotifyGui = Instance.new("ScreenGui", Player.PlayerGui)
NotifyGui.Name = "VulkanNotify"

function Vulkan:Notify(title, text, time)
    local Frame = Instance.new("Frame", NotifyGui)
    Frame.Size = UDim2.fromOffset(260,80)
    Frame.Position = UDim2.fromScale(1,1)
    Frame.AnchorPoint = Vector2.new(1,1)
    Frame.BackgroundColor3 = Theme.Container
    Instance.new("UICorner", Frame).CornerRadius = UDim.new(0,14)

    local Title = Instance.new("TextLabel", Frame)
    Title.Text = title
    Title.Font = Enum.Font.GothamBold
    Title.TextSize = 14
    Title.TextColor3 = Theme.Text
    Title.BackgroundTransparency = 1
    Title.Position = UDim2.fromOffset(12,8)
    Title.Size = UDim2.new(1,-24,0,20)

    local Body = Instance.new("TextLabel", Frame)
    Body.Text = text
    Body.Font = Enum.Font.Gotham
    Body.TextSize = 13
    Body.TextWrapped = true
    Body.TextColor3 = Theme.Text
    Body.BackgroundTransparency = 1
    Body.Position = UDim2.fromOffset(12,30)
    Body.Size = UDim2.new(1,-24,0,40)

    Tween(Frame, TweenInfo.new(0.4,Enum.EasingStyle.Quint),
        {Position = UDim2.new(1,-20,1,-100)})

    task.delay(time or 3,function()
        Tween(Frame,TweenInfo.new(0.4),{Transparency=1})
        task.wait(0.4)
        Frame:Destroy()
    end)
end

--// Window
function Vulkan:CreateWindow(cfg)
    local Window = {}
    local Tabs = {}
    local Scale = 1
    local ConfigFile = cfg.ConfigName and ("Vulkan_"..cfg.ConfigName..".json")

    --// Load Config
    if canSave and ConfigFile and isfile(ConfigFile) then
        Config = HttpService:JSONDecode(readfile(ConfigFile))
    end

    local GUI = Instance.new("ScreenGui", Player.PlayerGui)

    local Main = Instance.new("Frame", GUI)
    Main.Size = UDim2.fromScale(0.5,0.6)
    Main.Position = UDim2.fromScale(0.5,0.5)
    Main.AnchorPoint = Vector2.new(0.5,0.5)
    Main.BackgroundColor3 = Theme.Background
    Instance.new("UICorner", Main).CornerRadius = UDim.new(0,18)

    Tween(Blur,TweenInfo.new(0.4),{Size=15})

    local UIScale = Instance.new("UIScale", Main)
    UIScale.Scale = 1

    --// Save
    local function Save()
        if canSave and ConfigFile then
            writefile(ConfigFile,HttpService:JSONEncode(Config))
        end
    end

    --// Tabs
    function Window:CreateTab(name)
        local Tab = {}
        local Elements = {}

        local Page = Instance.new("ScrollingFrame", Main)
        Page.Size = UDim2.fromScale(1,1)
        Page.ScrollBarImageTransparency = 1
        Page.Visible = false

        local Layout = Instance.new("UIListLayout", Page)
        Layout.Padding = UDim.new(0,8)

        Layout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
            Page.CanvasSize = UDim2.new(0,0,0,Layout.AbsoluteContentSize.Y+10)
        end)

        --// Search Bar
        function Tab:CreateSearchBar()
            local Box = Instance.new("TextBox", Page)
            Box.PlaceholderText = "Search..."
            Box.Size = UDim2.new(1,-10,0,36)
            Box.BackgroundColor3 = Theme.Container
            Instance.new("UICorner", Box).CornerRadius = UDim.new(0,12)

            Box:GetPropertyChangedSignal("Text"):Connect(function()
                for _,el in pairs(Elements) do
                    el.Visible = el.Name:lower():find(Box.Text:lower()) ~= nil
                end
            end)
        end

        --// Slider
        function Tab:CreateSlider(cfg)
            local Holder = Instance.new("Frame", Page)
            Holder.Name = cfg.Name
            Holder.Size = UDim2.new(1,-10,0,50)
            Holder.BackgroundColor3 = Theme.Container
            Instance.new("UICorner", Holder).CornerRadius = UDim.new(0,12)

            table.insert(Elements,Holder)

            local val = Config[cfg.Flag] or cfg.Default
            Config[cfg.Flag] = val

            local Bar = Instance.new("Frame", Holder)
            Bar.Position = UDim2.fromOffset(10,30)
            Bar.Size = UDim2.new(1,-20,0,6)
            Bar.BackgroundColor3 = Theme.Background

            local Fill = Instance.new("Frame", Bar)
            Fill.Size = UDim2.fromScale((val-cfg.Min)/(cfg.Max-cfg.Min),1)
            Fill.BackgroundColor3 = Theme.Accent

            Bar.InputBegan:Connect(function(i)
                if i.UserInputType == Enum.UserInputType.MouseButton1 then
                    UIS.InputChanged:Connect(function(inp)
                        local pct = math.clamp((inp.Position.X-Bar.AbsolutePosition.X)/Bar.AbsoluteSize.X,0,1)
                        local new = math.floor(cfg.Min+(cfg.Max-cfg.Min)*pct)
                        Fill.Size = UDim2.fromScale(pct,1)
                        Config[cfg.Flag]=new
                        Save()
                        cfg.Callback(new)
                    end)
                end
            end)
        end

        --// UI Scale Control
        function Tab:CreateUIScale()
            self:CreateSlider({
                Name="UI Scale",
                Min=70,
                Max=120,
                Default=100,
                Flag="UIScale",
                Callback=function(v)
                    UIScale.Scale = v/100
                end
            })
        end

        Tabs[#Tabs+1]=Page
        if #Tabs==1 then Page.Visible=true end

        return Tab
    end

    return Window
end

return Vulkan
